var OpenSongHost;$.support.cors=!0;var Playlist,sok,loadServiceBusy,loadControllerBusy,updateStatusBusy,lastUrl,lastMode="",lastSectie=-1,lastSlide=-1,currentSectie=-1,currentSlide=-1,totalSlides=-1,invoegVersie=1,ajaxBusy=0,loadDelay=500;function make_base_auth(e){return"Basic "+btoa(e)}null===localStorage.OpenSongHost&&(localStorage.OpenSongHost="127.0.0.1",localStorage.OpenSongPort="8082",localStorage.OpenSongPwd=""),OpenSongHost="ws://"+localStorage.OpenSongHost+":"+localStorage.OpenSongPort+"/ws",null===localStorage.OpenSongtekstSize?localStorage.OpenSongtekstSize="15":localStorage.OpenSongtekstSize>30&&(localStorage.OpenSongtekstSize="15"),null===localStorage.OpenSongDiaregelaar&&(localStorage.OpenSongDiaregelaar="a"),null===localStorage.OpenSongRemote&&(localStorage.OpenSongRemote="c"),null===localStorage.OpenSongDisplay&&(localStorage.OpenSongDisplay="2"),window.OpenSong={getElement:function(e){var t;if(!e)e=window.event;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),$(t)},loadService:function(e){e&&e.preventDefault(),1!=loadServiceBusy&&(loadServiceBusy=!0,console.log('GET "presentation/slide/list"'),$.ajax({type:"GET",url:OpenSongHost+"presentation/slide/list",dataType:"xml",success:function(e){Playlist=e,vorige="xxxxxxxxx",vorigesoort="";var t=1;$(Playlist).find("response").children().each(function(){if($(this).attr("identifier")){var e=$(this).attr("name"),n=$(this).attr("type");e==vorige&&n==vorigesoort||t++,$(this).attr("sectie",t),vorige=e,vorigesoort=n}});var n=$(e).find("response").find("slide").length;if(n!=totalSlides){totalSlides=n;var s=1,o=$("#service-manager > div[role=main] > ul");o.html(""),vorige="xxxxxxxxx",vorigesoort="",t=1,$(e).find("response").children().each(function(){if($(this).attr("identifier")){var e=$(this).attr("identifier"),n=$(this).attr("name"),i=$(this).attr("type");if(n!=vorige||i!=vorigesoort){$(this).find("title").text();if("song"==i){var r=$('<li data-icon="false">').append($('<a href="#">').attr("slide",e).attr("song",parseInt(s,10)).text(n));s++}else r=$('<li data-icon="false">').append($('<a href="#">').attr("slide",parseInt(e,10)).text(n));t++,r.attr("slide",e),r.attr("sectie",t),r.children("a").click(OpenSong.setSectie),o.append(r),vorige=n,vorigesoort=i}e++}}),o.haschildren&&o.listview().listview("refresh")}loadServiceBusy=!1,OpenSong.showService(),$("#slide-controller").is(":visible")&&OpenSong.loadController(currentSlide)}}))},showService:function(){var e=0,t=0;if(-1!=currentSlide){n=0==currentSectie?$(Playlist).find("response").find('slide[identifier="'+currentSlide+'"]').attr("sectie"):currentSectie,$("#service-manager div[role=main] ul .ui-btn-e").removeClass("ui-btn-e").addClass("ui-btn ui-btn-c"),$("#service-manager div[role=main] ul li").each(function(){var s=$(this);if(s.attr("sectie")==n)return s.find("a").removeClass("ui-btn-c").addClass("ui-btn ui-btn-e"),e=s.offset().top,t=s.height(),!1});try{$("#service-manager div[role=main] ul").listview("refresh");var s=$(window).height()-100,o=$(window).scrollTop();(e+t-o>s||e-t-t<o)&&$.mobile.silentScroll(e-s/2)}catch(e){}}else OpenSong.getStatus()},delayControllerSlide:function(e){setTimeout(function(){OpenSong.getControllerSlide(e)},(ajaxBusy-1)*loadDelay)},getControllerSlide:function(e){$.ajax({type:"GET",url:OpenSongHost+"presentation/slide/"+e,dataType:"xml",success:function(e){$(e).find("response").find("slide").attr("name")?naam=$(e).find("response").find("slide").attr("name"):naam="",slideId=$(e).find("response").attr("identifier"),tekst=$(e).find("response").find("slide").find("title").text(),verzen=$(e).find("response").find("slide").find("presentation").text(),""!=tekst?""!=verzen?(verzen=verzen.replace(/^V/i,""),verzen=verzen.replace(/ V/gi," "),verzen=verzen.replace(/B/gi,i18n.t("setup.bridge")),verzen=verzen.replace(/C/gi,i18n.t("setup.chorus")),verzen=verzen.replace(/T/gi,i18n.t("setup.tag")),verzen=verzen.replace(/ /g,", "),$("#controller-titel").text(tekst+": "+verzen)):$("#controller-titel").text(tekst):""!=naam?$("#controller-titel").text(naam):$("#controller-titel").text("(slide: "+currentSlide+"; item: "+currentSectie+")");var t=$(e).find("response").find("slide").attr("type");$(e).find("response").find("slide").find("slides").find("slide").each(function(){var n=$(this).find("body").text();if("image"==t){var s=$(e).find("response").find("slide").find("filename").text();n=n+i18n.t("setup.dia3")+": "+s.replace(/^.*[\\\/]/,""),$("#regelaarsoort-a").is(":checked")&&(n='<img src="'+OpenSongHost+"presentation/slide/"+slideId+'/image/width:160" align="right">'+n)}if("external"==t){var o=$(e).find("response").find("slide").attr("application");s=(s=$(e).find("response").find("slide").attr("filename")).replace(/^.*[\\\/]/,"");var i=$(this).find("description").text();n=n+"("+o+") "+i+" - "+s}if(n=(n=(n=(n=n.replace(/^\t/gm,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/-\n/gm,"&shy;")).replace(/\n/g,"<br>")).replace(/[ \u00A0]<br>/g," "),"song"==t&&$(this).attr("id")){var r=$(this).attr("id");verst=r.replace(/V/i,""),verst=verst.replace(/B/gi,i18n.t("setup.bridge")),verst=verst.replace(/C/gi,i18n.t("setup.chorus")),verst=verst.replace(/T/gi,i18n.t("setup.tag")),n="<sup>"+verst+" </sup>"+n}$("#regelaarsoort-b").is(":checked")&&(n='<div style="float:right;"><img src="'+OpenSongHost+"presentation/slide/"+slideId+'/image/width:240/quality:85"></div>'+n),$("#regelaarsoort-c").is(":checked")&&(n='<span>&nbsp;</span><img src="'+OpenSongHost+"presentation/slide/"+slideId+'/image/width:360/quality:85">'),$("#slide-controller div[role=main] ul li a").each(function(){var e=$(this);if(e.attr("slide")==slideId)return e.attr("vers",r).html(n),!1})}),--ajaxBusy<=0&&OpenSong.showController()}})},loadController:function(){var e=$("#slides li").length;if(!(currentSectie==lastSectie&&-1!=lastSectie&&e>1)&&1!=loadControllerBusy){lastSectie=currentSectie;var t=currentSlide;ajaxBusy=0;var n=$("#slides");if(n.html(""),soort=$(Playlist).find("response").find('slide[identifier="'+t+'"]').attr("type"),"blank"==soort){$("#controller-titel").text("(slide: "+t+"; item: "+currentSectie+")"),(o=$('<li data-icon="false">').append($('<a href="#">').attr("slide",t).html(""))).children("a").click(OpenSong.setSlide),n.append(o),t++}else{loadControllerBusy=!0;var s=$(Playlist).find("response").find('slide[identifier="'+t+'"]').attr("sectie");$(Playlist).find("response").find("slide").each(function(){if($(this).attr("sectie")==s){var e=$(this).attr("identifier");vers="0",tekst=i18n.t("setup.dia4");var o=$('<li data-icon="false" id="slides">').append($('<a href="#">').attr("slide",parseInt(e,10)).attr("vers",vers).html(tekst));o.children("a").click(OpenSong.setSlide),n.append(o),lastUrl="presentation/slide/"+e,ajaxBusy++,console.log("ajax call %d gequeued",t),OpenSong.delayControllerSlide(e),t=++e}})}if($(Playlist).find("response").find('slide[identifier="'+t+'"]')){titel=$(Playlist).find("response").find('slide[identifier="'+t+'"]').find("title").text(),naam=$(Playlist).find("response").find('slide[identifier="'+t+'"]').attr("name");var o,i=$(Playlist).find("response").find('slide[identifier="'+t+'"]').attr("identifier");naam!=titel&&(titel=naam+" "+titel),(o=$('<li data-icon="false">').append($('<a href="#">').attr("slide",i).html(i18n.t("nav.next")+": "+titel))).children("a").click(OpenSong.setSlide),n.append(o);s=$(Playlist).find("response").find('slide[identifier="'+t+'"]').attr("sectie");s++,$(Playlist).find("response").find("slide").each(function(){if($(this).attr("sectie")==s){titel=$(this).find("title").text(),naam=$(this).attr("name"),naam!=titel&&(titel=naam+" "+titel);var e=$(this).attr("identifier"),t=$('<li data-icon="false">').append($('<a href="#">').attr("slide",e).html(i18n.t("nav.then")+": "+titel));return t.children("a").click(OpenSong.setSlide),n.append(t),!1}})}n.listview().listview("refresh"),loadControllerBusy=!1}},showController:function(){if(-1!=currentSlide){var e=0,t=0;$("#slide-controller div[role=main] ul  .ui-btn-e").removeClass("ui-btn-e").addClass("ui-btn"),$("#slide-controller div[role=main] ul a").each(function(){var n=$(this);if(n.attr("slide")==currentSlide.toString())return n.removeClass("ui-btn-c").addClass("ui-btn-e"),n=n.parent(),e=n.offset().top,t=n.height(),!1}),$("#slide-controller div[role=main] ul").listview("refresh");var n=$(window).height()-100,s=$(window).scrollTop();(e+t-s>n||e-t-t<s)&&$.mobile.silentScroll(e-n/2)}else OpenSong.getStatus()},showRemoteScreen:function(){if($("#screensoort-a").is(":checked")&&"B"!=lastMode?$("#remote-screen").removeClass("ui-page-theme-a").addClass("ui-page-theme-c"):$("#remote-screen").removeClass("ui-page-theme-c").addClass("ui-page-theme-a"),"N"==lastMode){var e=currentSlide,t=localStorage.OpenSongtekstSize;lastUrl="presentation/slide/"+e,$.ajax({type:"GET",url:OpenSongHost+lastUrl,dataType:"xml",success:function(n){if(titel=$(n).find("response").find("slide").find("title").text(),verzen=$(n).find("response").find("slide").find("presentation").text(),""!=titel){if(""!=verzen.trim()){var s;for(aVerzen=verzen.split(" "),currentVers=$(n).find("response").find("slides").find("slide").attr("PresentationIndex"),verzen="",s=0;s<aVerzen.length;s++)s==currentVers-1?(/^B/i.test(aVerzen[s])&&(verzen+="<strong>"+i18n.t("setup.bridge")+"</strong> "),/^C/i.test(aVerzen[s])&&(verzen+="<strong>"+i18n.t("setup.chorus")+"</strong> "),/^T/i.test(aVerzen[s])&&(verzen+="<strong>"+i18n.t("setup.tag")+"</strong> "),/^V(\S)*/i.test(aVerzen[s])&&(verzen+="<strong>"+aVerzen[s].substr(1,15)+"</strong> ")):/^V(\S)*/i.test(aVerzen[s])&&(verzen+=aVerzen[s].substr(1,15)+" ");titel+=": "+verzen.trim().toLowerCase().replace(/ /g,", ")}}else titel="";var o=$(n).find("response").find("slide").attr("type");$(n).find("response").find("slide").find("slides").find("slide").each(function(){var s=$(this).find("body").text();if("image"==o||$("#screensoort-c").is(":checked")){$("#current-screen-titel").css("font-size",.85*t+"vmin").html(""),$("#remote-main").addClass("geenpad");var i=$(window).width(),r=$(window).height()-20;s='<img src="'+OpenSongHost+"presentation/slide/"+e,s=(s=r<16*i/9?s+"/image/height:"+r:s+"/image/width:"+i)+'/Math.random()" width="'+i+'px">'}else $("#remote-main").removeClass("geenpad"),$("#current-screen-titel").css("font-size",.85*t+"vmin").html(titel);if("external"==o){var a=$(n).find("response").find("slide").attr("application"),l=$(n).find("response").find("slide").attr("filename");l=l.replace(/^.*[\\\/]/,""),s=s+"("+a+") "+$(this).find("description").text()+" - "+l}if("song"==o&&$(n).attr("id")){var p=$(n).attr("id");verst=p.replace(/V/gi,""),verst=verst.replace(/C/gi,"refr"),presentid=$(this).attr("PresentationIndex"),presentid!=lastpresentid&&(s="<sup>"+verst+". </sup>"+s,lastpresentid=presentid)}"scripture"==o&&(s=s.replace(/(\d\d?\d?[abc]?) /g,"<sup>$1&nbsp;</sup>")),s=(s=(s=(s=s.replace(/^\t/gm,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/-\n/gm,"&shy;")).replace(/\n/g,"<br>")).replace(/[ \u00A0]<br>/g," "),"image"==o||$("#screensoort-c").is(":checked")?$("#current-screen-tekst").css("font-size","1px").html(s):$("#current-screen-tekst").css("font-size",t+"vmin").html(s)})}})}else"F"!=lastMode&&($("#current-screen-titel").text(" "),$("#current-screen-tekst").html(""))},doeAktie:function(e,t){lastUrl=t,""!=localStorage.OpenSongPwd?$.ajax({type:"POST",url:OpenSongHost+t,crossDomain:!0,dataType:e,headers:{Authorization:make_base_auth(localStorage.OpenSongPwd)},xhrFields:{withCredentials:!0},succes:function(e,t,n){$("#host-status2").html("last Ajax response: "+e)}}):$.ajax({type:"POST",url:OpenSongHost+t,crossDomain:!0,dataType:e,succes:function(e){$("#host-status2").html("last Ajax response: "+e)}})},setSectie:function(e){e.preventDefault();var t=OpenSong.getElement(e).attr("slide");OpenSong.doeAktie("text","presentation/slide/"+t),$("body").pagecontainer("change","#slide-controller")},setSlide:function(e){e.preventDefault();var t=OpenSong.getElement(e).attr("slide");OpenSong.doeAktie("text","presentation/slide/"+t)},updateStatus:function(e){if("OK"!=e&&1!=updateStatusBusy){if(updateStatusBusy=!0,parser=new DOMParser,xml=parser.parseFromString(e,"text/xml"),"1"==$(xml).find("response").find("presentation").attr("running")){$("#host-status").html(i18n.t("setup.net2")),$(xml).find("response").find("presentation").find("slide").attr("itemnumber")&&(currentSlide=$(xml).find("response").find("presentation").find("slide").attr("itemnumber")),currentSectie=$(Playlist).find("response").find('slide[identifier="'+currentSlide+'"]').attr("sectie")?$(Playlist).find("response").find('slide[identifier="'+currentSlide+'"]').attr("sectie"):0;var t=$(xml).find("response").find("presentation").find("screen").attr("mode");statusReden=$(Playlist).find("response").attr("reason"),void 0!==statusReden&&(invoegVersie=2,lastSlide=-1,lastSectie=-1),statusNaam=$(xml).find("response").find("presentation").find("slide").find("name").text(),playItemName=$(Playlist).find("response").find('slide[identifier="'+currentSlide+'"]').attr("name"),""!==statusNaam&&statusNaam!==playItemName&&(lastSlide=-1,lastSectie=-1)}else $("#host-status").html("<strong>"+i18n.t("setup.net6")+"</strong> ("+i18n.t("setup.net2")+")"),t="X",playlist="",lastStatus="",lastMode="",lastSectie=-1,lastSlide=-1,currentSectie=-1,currentSlide=-1,totalSlides=-1,loadServiceBusy=!1,loadControllerBusy=!1,updateStatusBusy=!1,$(".status-show").removeClass("ui-btn-c ui-btn-c").addClass("ui-btn-b"),$("#service-manager > div[role=main] > ul").html('<li data-icon="false">'+i18n.t("setup.net6")+"</li>"),$("#service-manager > div[role=main] > ul").listview().listview("refresh"),$("#slide-controller > div[role=main] > ul").html(""),$("#slide-controller").is(":visible")&&$("#controller-titel").text(i18n.t("setup.net6")),$("#remote-screen").is(":visible")&&($("#remote-screen").removeClass("ui-page-theme-c").addClass("ui-page-theme-a"),$("#current-screen-titel").text(i18n.t("setup.net6")),$("#current-screen-tekst").html("")),$("#presentatie").is(":visible")&&($("#set-show").removeClass("ui-btn-b").addClass("ui-btn-e"),$("#set-stop1").removeClass("ui-btn-e").addClass("ui-btn-b")),$("#search").is(":visible")&&($("#song-show").removeClass("ui-btn-b").addClass("ui-btn-e"),$("#song-stop1").removeClass("ui-btn-e").addClass("ui-btn-b"));var n=0;switch(t!=lastMode&&(n=1),lastMode=t,$(".status-show").removeClass("ui-btn-c").addClass("ui-btn-b"),$(".status-zwart, .status-freeze, .status-theme").removeClass("ui-btn-c ui-btn-e").addClass("ui-btn-b"),$("#controller-modeC").html("&nbsp;"),$("#controller-modeS").html("&nbsp;"),t){case"N":$(".status-show").removeClass("ui-btn-b").addClass("ui-btn-c"),$("#controller-modeC").text(i18n.t("state.normal")),$("#controller-modeS").text(i18n.t("state.normal"));break;case"B":$(".status-zwart").removeClass("ui-btn-b").addClass("ui-btn-e"),$("#controller-modeC").text(i18n.t("state.black")),$("#controller-modeS").text(i18n.t("state.black"));break;case"F":$(".status-freeze").removeClass("ui-btn-b").addClass("ui-btn-e"),$("#controller-modeC").text(i18n.t("state.freeze")),$("#controller-modeS").text(i18n.t("state.freeze"));break;case"H":$(".status-theme").removeClass("ui-btn-b").addClass("ui-btn-e"),$("#controller-modeC").text(i18n.t("state.hide")),$("#controller-modeS").text(i18n.t("state.hide"))}"X"!=t&&(-1==lastSlide?OpenSong.loadService():($("#service-manager").is(":visible")&&lastSlide!=currentSlide&&currentSlide>0&&OpenSong.showService(),$("#slide-controller").is(":visible")&&(-1!=lastSectie&&lastSectie==currentSectie||OpenSong.loadController(currentSlide),lastSlide!=currentSlide&&currentSlide>0&&OpenSong.showController(currentSlide))),$("#remote-screen").is(":visible")&&(n>0||lastSlide!=currentSlide&&currentSlide>0)&&OpenSong.showRemoteScreen(currentSlide)),lastSlide=currentSlide,updateStatusBusy=!1}},nextItem:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/section/next")},previousItem:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/section/previous","")},nextSlide:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/slide/next","")},previousSlide:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/slide/previous","")},blankDisplay:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/screen/toggle_black",""),$("#popupModeC").parent().hasClass("ui-popup-active")&&$("#popupModeC").popup("close"),$("#popupModeS").parent().hasClass("ui-popup-active")&&$("#popupModeS").popup("close")},themeDisplay:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/screen/toggle_hide",""),$("#popupModeC").parent().hasClass("ui-popup-active")&&$("#popupModeC").popup("close"),$("#popupModeS").parent().hasClass("ui-popup-active")&&$("#popupModeS").popup("close")},freezeDisplay:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/screen/toggle_freeze",""),$("#popupModeC").parent().hasClass("ui-popup-active")&&$("#popupModeC").popup("close"),$("#popupModeS").parent().hasClass("ui-popup-active")&&$("#popupModeS").popup("close")},showDisplay:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/screen/normal",""),$("#popupModeC").parent().hasClass("ui-popup-active")&&$("#popupModeC").popup("close"),$("#popupModeS").parent().hasClass("ui-popup-active")&&$("#popupModeS").popup("close")},setHost:function(e){if(void 0!==e&&e.preventDefault(),OpenSong.saveSettings,void 0!==t&&1==t.readyState&&t.close(),OpenSongHost="http://"+$("#set-host").val()+":"+$("#set-port").val()+"/",OpenSongWs="ws://"+$("#set-host").val()+":"+$("#set-port").val()+"/ws",OpenSong.saveSettings(),$("#host-status2").html(""),$("#host-status").html(i18n.t("setup.net3",{host:OpenSongHost})),"WebSocket"in window){var t=new WebSocket(OpenSongWs);t.onopen=function(){$("#host-status").html(i18n.t("setup.net2")),t.send("/ws/subscribe/presentation"),$("#setup").is(":visible")&&$("body").pagecontainer("change","#slide-controller")},t.onmessage=function(e){OpenSong.updateStatus(e.data)},t.onerror=function(){$("#host-status").html("<strong>"+i18n.t("setup.net3")+"</strong>"),$("#host-status").html("<strong>"+i18n.t("setup.net4")+"</strong>"),$("#remote-screen").is(":visible")?($("#current-screen-titel").text(i18n.t("setup.net4")),$("#current-screen-tekst").text(""),setTimeout(function(){OpenSong.setHost()},6e4)):$("body").pagecontainer("change","#setup")},t.onclose=function(){$("#host-status").html("<strong>"+i18n.t("setup.net4")+"</strong>"),$("#remote-screen").is(":visible")?($("#current-screen-titel").text(i18n.t("setup.net4")),$("#current-screen-tekst").text(""),setTimeout(function(){OpenSong.setHost()},6e4)):$("body").pagecontainer("change","#setup")}}else $("#host-status").html("<strong>"+i18n.t("setup.net5")+"</strong>");OpenSong.Herladen()},showHost:function(e){e.preventDefault(),$("input[id=set-host]").val(localStorage.OpenSongHost),$("input[id=set-port]").val(localStorage.OpenSongPort),void 0!==localStorage.OpenSongPwd&&""!=localStorage.OpenSongPwd&&$("input[id=set-pwd]").val(localStorage.OpenSongPwd+"                  "),$("#screen-size").val(localStorage.OpenSongtekstSize),$("#screen-size").slider("refresh");var t=localStorage.OpenSongRemote;$("input:radio[name=screensoort-]").filter("[value="+t+"]").attr("checked","checked"),$("input:radio[name=screensoort-]").checkboxradio("refresh"),t=localStorage.OpenSongDiaregelaar,$("input:radio[name=regelaarsoort-]").filter("[value="+t+"]").attr("checked","checked"),$("input:radio[name=regelaarsoort-]").checkboxradio("refresh"),t=localStorage.OpenSongDisplay,$("input:radio[name=display-]").filter("[value="+t+"]").attr("checked","checked")},Herladen:function(){playlist="",lastStatus="",lastMode="",lastSectie=-1,lastSlide=-1,currentSectie=-1,currentSlide=-1,loadServiceBusy=!1,loadControllerBusy=!1,updateStatusBusy=!1,$("#search-sets").empty(),$("#search-folders").empty(),null===localStorage.OpenSongHost?$("body").pagecontainer("change","#setup"):($("#service-manager").is(":visible")&&OpenSong.showService(),$("#slide-controller").is(":visible")&&OpenSong.showController(),$("#remote-screen").is(":visible")&&OpenSong.showRemoteScreen()),OpenSong.getStatus()},showAlert:function(e){e.preventDefault();$("#set-pwd").val();var t=$("#alert-text").val();OpenSong.doeAktie("text","presentation/screen/alert/message:"+encodeURI(t)),$("#alert-status").html("<br>"+i18n.t("alert.alert")+": "+t)},cancelAlert:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/screen/alert/"),$("#alert-status").html("<br>"+i18n.t("alert.noalert"))},getStatus:function(e){e&&e.preventDefault(),lastUrl="presentation/status",$.ajax({type:"GET",url:OpenSongHost+"presentation/status",dataType:"text",success:function(e){OpenSong.updateStatus(e)}})},loadRemoteScreen:function(){OpenSong.showRemoteScreen()},showRemoteMenu:function(){$("#leftpanel1").panel("open"),setTimeout(function(){$("#leftpanel1").panel("close")},7e3)},showPresent:function(){$("#search-sets").find("option").length<=0&&($("#sets-status").show(),$("#search-sets").empty(),$("#search-sets").append('<option value="choose-one">'+i18n.t("setup.choose")+"</option>"),lastUrl=OpenSongHost+"set/list/",$.ajax({type:"GET",url:OpenSongHost+"set/list",dataType:"xml",success:function(e){Folders=e,$(Folders).find("response").children().each(function(){if($(this).attr("id")){var e=$(this).text();$("#search-sets").append('<option value="'+e+'">'+e+"</option>")}}),$("#search-sets").selectmenu("refresh"),$("#search-sets option:first").attr("selected","selected"),$("#sets-status").hide()}}));var e=localStorage.OpenSongDisplay;$("input:radio[name=display-]").filter("[value="+e+"]").attr("checked","checked"),$("input:radio[name=display-]").checkboxradio("refresh"),"X"!=lastMode?($("#set-show").removeClass("ui-btn-e").addClass("ui-btn-b"),$("#set-stop1").removeClass("ui-btn-b").addClass("ui-btn-e")):($("#set-show").removeClass("ui-btn-b").addClass("ui-btn-e"),$("#set-stop1").removeClass("ui-btn-e").addClass("ui-btn-b"))},loadSearch:function(){lastUrl=OpenSongHost+"song/folders/",$("#search-folders").find("option").length<=0&&$.ajax({type:"GET",url:OpenSongHost+"song/folders/",dataType:"xml",success:function(e){Folders=e,$(Folders).find("response").find("folders").children().each(function(){if($(this).attr("name")){var e=$(this).attr("name");e.indexOf("( ")<0&&$("#search-folders").append('<option value="'+e+'">'+e+"</option>")}}),$("#search-folders").prop("selectedIndex",0).selectmenu("refresh"),OpenSong.doeSearch()}})},showSearch:function(){$("#search-folders").find("option").length<=0&&OpenSong.loadSearch(),$("#song-insert").removeClass("ui-btn-e").addClass("ui-btn-b");var e=0,t=0;$("#search-results a").each(function(){var n=$(this);if(n.hasClass("ui-btn-e"))return n=n.parent(),e=n.offset().top,t=n.height(),!1});var n=$(window).height()-100,s=$(window).scrollTop();(e+t-s>n||e-t-t<s)&&$.mobile.silentScroll(e-n/2)},doeSearch:function(e){$("#song-insert").removeClass("ui-btn-e").addClass("ui-btn-b"),$("#song-status").show(),$("#search-results").empty(),$('input[data-type="search"]').val(""),map=$("#search-folders option:selected").text(),lastUrl=OpenSongHost+"song/list/folder:"+encodeURI(map),$.ajax({type:"GET",url:lastUrl,dataType:"xml",success:function(e){Songs=e,$(Songs).find("response").children().each(function(){if($(this).attr("name")){var e=$(this).attr("name"),t=$('<li data-icon="false">').append($('<a href="#">').text(e));t.children("a").click(OpenSong.selectSearch),$("#search-results").append(t)}}),$("#search-results").listview().listview("refresh"),$("#song-status").hide()}})},selectSearch:function(){var e=$(this).text();$("#search-results .ui-btn-e").removeClass("ui-btn-e").addClass("ui-btn"),$("#search-results a").each(function(){var t=$(this);if(t.text()==e)return t.removeClass("ui-btn-c").addClass("ui-btn-e"),!1}),$("#search-results").listview("refresh"),"X"!=lastMode?$("#song-insert").removeClass("ui-btn-b").addClass("ui-btn-e"):$("#song-insert").removeClass("ui-btn-e").addClass("ui-btn-b")},insertSong:function(e){e&&e.preventDefault(),map=$("#search-folders option:selected").text(),song=$("#search-results .ui-btn-e").text(),$("#songselect").text(map+"/"+song),$("#songselect2").text(),$("#popupSong").popup("open"),lastUrl=OpenSongHost+"song/detail/"+encodeURI(song)+"/folder:"+encodeURI(map),$.ajax({type:"GET",url:lastUrl,dataType:"xml",success:function(e){dezeSong=$(e).find("response").find("song"),titel=$(dezeSong).find("title").text(),titel!=song?$("#songselect").text(map+"/ "+song):$("#songselect").text(map),$("#songselect2").text(titel),volgorde=$(dezeSong).find("presentation").text(),$("#set-verse").val(volgorde),songtekst=$(dezeSong).find("lyrics").text(),$("#songLyrics").html(songtekst),$("#songLyrics").scrollTop(0)}})},insertSongYes:function(e){e&&e.preventDefault(),map=$("#search-folders option:selected").text(),song=$("#search-results .ui-btn-e").text(),verses=$("#set-verse").val(),invoegVersie>=2&&(verses=verses.replace(/ /gi,",")),verses=verses.trim(),OpenSong.doeAktie("text","presentation/slide/song/folder:"+encodeURI(map)+"/song:"+encodeURI(song)+"/order:"+encodeURI(verses),""),$("#popupSong").popup("close"),1==invoegVersie&&(lastSlide=-1,lastSectie=-1,totalSlides=-1,OpenSong.getStatus()),setTimeout(function(){$("body").pagecontainer("change","#service-manager")},1e3)},presentShow:function(e){if(e&&e.preventDefault(),$("#set-show").hasClass("ui-btn-e")){present=$("#search-sets option:selected").val();var t=$("input[name=display-]:checked").val();OpenSong.doeAktie("text","set/present/"+encodeURI(present)+"/display:"+t,""),$("body").pagecontainer("change","#service-manager")}else $("#popupP").popup("open")},presentStop:function(e){e.preventDefault(),OpenSong.doeAktie("text","presentation/close"),$("#popupP").parent().hasClass("ui-popup-active")&&($("#popupP").popup("close"),setTimeout(function(){OpenSong.presentShow()},3e3))},saveSettings:function(){localStorage.OpenSongHost=$("#set-host").val(),localStorage.OpenSongPort=$("#set-port").val(),localStorage.OpenSongPwd=$.trim($("#set-pwd").val()),localStorage.OpenSongRemote=$("input[name=screensoort-]:checked").val(),localStorage.OpenSongtekstSize=$("#screen-size").val(),localStorage.OpenSongDiaregelaar=$("input[name=regelaarsoort-]:checked").val(),localStorage.OpenSongDisplay=$("input[name=display-]:checked").val()},escapeString:function(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},$(document).on("mobileinit",function(){$.mobile.allowCrossDomainPages=!0,$.mobile.defaultPageTransition="none",$.mobile.phonegapNavigationEnabled=!0}),$(document).on("pagecontainerchange",function(e,t){t.toPage[0].id}),$(document).on("pageshow","#service-manager",OpenSong.showService),$(document).on("click","#service-next",OpenSong.nextItem),$(document).on("click","#service-previous",OpenSong.previousItem),$(document).on("pageinit","#slide-controller",function(){$("#slide-controller").on("swipeleft",OpenSong.previousSlide),$("#slide-controller").on("swiperight",OpenSong.nextSlide)}),$(document).on("pagebeforeshow","#slide-controller",OpenSong.loadController),$(document).on("click","#controller-next",OpenSong.nextSlide),$(document).on("click","#controller-previous",OpenSong.previousSlide),$(document).on("click","#controller2-next",OpenSong.nextSlide),$(document).on("click","#controller2-previous",OpenSong.previousSlide),$(document).on("pagebeforeshow","#remote-screen",OpenSong.loadRemoteScreen),$(document).on("click","#remote-screen",OpenSong.showRemoteMenu),$(document).on("click","#remote-main",OpenSong.showRemoteMenu),$("#remote-screen").on("swiperight",OpenSong.showRemoteMenu),$(document).on("click","#controller-blank",OpenSong.blankDisplay),$(document).on("click","#controller-theme",OpenSong.themeDisplay),$(document).on("click","#controller-freeze",OpenSong.freezeDisplay),$(document).on("click","#controller-show",OpenSong.showDisplay),$(document).on("pagebeforeshow","#setup",OpenSong.showHost),$(document).on("click","#set-submit",OpenSong.setHost),$(document).on("click","#alert-submit",OpenSong.showAlert),$(document).on("click","#alert-cancel",OpenSong.cancelAlert),$(document).on("pageshow","#presentatie",OpenSong.showPresent),$(document).on("click","#set-show",OpenSong.presentShow),$(document).on("click","#set-stop1",OpenSong.presentStop),$(document).on("click","#set-stop2",OpenSong.presentStop),$(document).on("pageshow","#search",OpenSong.showSearch),$(document).on("click","#song-insert",OpenSong.insertSong),$(document).on("click","#song-insert2",OpenSong.insertSongYes),$(document).on("change","#search-folders",OpenSong.doeSearch),$(document).on("panelopen","#leftpanel1",OpenSong.saveSettings),$.ajaxSetup({error:function(e,t,n){0!=e.status&&$("#host-status2").html("ajaxError: "+lastUrl+" <strong>"+n+"</strong>")},cache:!0,crossDomain:!0});